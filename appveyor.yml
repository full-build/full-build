os: Visual Studio 2015

environment:
  GITHUB_TOKEN:
    secure: SNU7aaT74dbTXWCsWeFxWvfwJ4BLItFdO2EY7MYoEg9vec2EGBloH8PNDpkJbBKg

skip_tags: true

version: 3.0.{build}

shallow_clone: true

build_script:
  - cmd: build-all.cmd %APPVEYOR_BUILD_VERSION%
  
test_script:
  - ps: . .\pushtestresult.ps1

artifacts:
  - path: apps/full-build.zip
    name: app

  - path: apps/full-build.nupkg
    name: nuget

deploy:
  - provider: GitHub
    release: 'full-build v$(appveyor_build_version)'
    description: '$(appveyor_repo_commit) $(appveyor_repo_commit_message)'
    auth_token:
      secure: jFxLxYAyEMeg/TrfZ4oelM/HvdNR4ZtpiZYAqRrljzFdwiWBktkzh3N/UWLkFxpo
    artifact: apps/full-build.zip
    draft: false
    prerelease: false
    on:
      branch: master
      appveyor_repo_tag: false

  - provider: NuGet
    api_key:
      secure: Fa/KRLSPeo1w78xW6Yb6FJv3amW/BRcLKpy7DW7e0/mdsiug7GBA36twg2HOUCSS
    skip_symbols: true
    symbol_server:
    artifacts: apps/full-build.nupkg
    on:
      branch: master

notifications:
  - provider: GitHubPullRequest
    auth_token:
      secure: jFxLxYAyEMeg/TrfZ4oelM/HvdNR4ZtpiZYAqRrljzFdwiWBktkzh3N/UWLkFxpo
    template: '{{#passed}}:white_check_mark:{{/passed}}{{#failed}}:x:{{/failed}} [Build {{&projectName}} {{buildVersion}} {{status}}]({{buildUrl}}) (commit {{commitUrl}} by @{{&commitAuthorUsername}})'

  - provider: Slack
    incoming_webhook:
      secure: gA2eVzMFIFRHZpWx6bDTbKCKGFOWEe3zRukzC4PTWklKnLTsIzm/TLqa/oGgPSFiSR7DsBLKpp1Tkd4eIEy2QlzqAwFx4IknxGh4igmbB7k=
    channel: '#builds'
