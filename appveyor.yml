os: Visual Studio 2015

environment:
  GITHUB_TOKEN:
    secure: SNU7aaT74dbTXWCsWeFxWvfwJ4BLItFdO2EY7MYoEg9vec2EGBloH8PNDpkJbBKg

skip_tags: true

version: 2.2.{build}

clone_depth: 1

build_script:
  - cmd: build-all.cmd %APPVEYOR_BUILD_VERSION%.*
  
test:
  assemblies:
  
after_test:
  - ps: (New-Object 'System.Net.WebClient').UploadFile("https://ci.appveyor.com/api/testresults/nunit2/$($env:APPVEYOR_JOB_ID)", (Resolve-Path .\TestResult.xml))

artifacts:
  path: apps/full-build.zip
  name: full-build

deploy:
  release: 'full-build v$(appveyor_build_version)'
  description: '$(appveyor_repo_commit) $(appveyor_repo_commit_message)'
  provider: GitHub
  auth_token:
    secure: SNU7aaT74dbTXWCsWeFxWvfwJ4BLItFdO2EY7MYoEg9vec2EGBloH8PNDpkJbBKg
  artifact: apps/full-build.zip
  draft: false
  prerelease: true
  on:
    branch: master
    appveyor_repo_tag: false
  
notifications:
  - provider: GitHubPullRequest
    auth_token:
      secure: SNU7aaT74dbTXWCsWeFxWvfwJ4BLItFdO2EY7MYoEg9vec2EGBloH8PNDpkJbBKg
    template: "{{#passed}}:white_check_mark:{{/passed}}{{#failed}}:x:{{/failed}} [Build {{&projectName}} {{buildVersion}} {{status}}]({{buildUrl}}) (commit {{commitUrl}} by @{{&commitAuthorUsername}})"
